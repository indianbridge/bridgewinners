'use strict';var Bridge={directions:{n:{name:"North",lho:"e",rho:"w",cho:"s",index:0,html:"North"},e:{name:"East",lho:"s",rho:"n",cho:"w",index:1,html:"East"},s:{name:"South",lho:"w",rho:"e",cho:"n",index:2,html:"South"},w:{name:"West",lho:"n",rho:"s",cho:"e",index:3,html:"West"}},directionOrder:[],suits:{s:{name:"Spades",index:0,html:'<font color="000000">&spades;</font>'},h:{name:"Hearts",index:1,html:'<font color="CB0000">&hearts;</font>'},d:{name:"Diamonds",index:2,html:'<font color="CB0000">&diams;</font>'},
c:{name:"Clubs",index:3,html:'<font color="000000">&clubs;</font>'}},suitOrder:[],calls:{n:{name:"No Trump",index:0,bid:!0,html:'<font color="000000">NT</font>'},s:{name:"Spades",index:1,bid:!0,html:'<font color="000000">&spades;</font>'},h:{name:"Hearts",index:2,bid:!0,html:'<font color="CB0000">&hearts;</font>'},d:{name:"Diamonds",index:3,bid:!0,html:'<font color="CB0000">&diams;</font>'},c:{name:"Clubs",index:4,bid:!0,html:'<font color="000000">&clubs;</font>'},p:{name:"Pass",index:5,bid:!1,html:'<font color="green">P</font>'},
x:{name:"Double",index:6,bid:!1,html:'<font color="red">X</font>'},r:{name:"Redouble",index:7,bid:!1,html:'<font color="blue">XX<font>'}},callOrder:[],ranks:{a:{name:"Ace",index:0,html:"A"},k:{name:"King",index:1,html:"K"},q:{name:"Queen",index:2,html:"Q"},j:{name:"Jack",index:3,html:"J"},t:{name:"Ten",index:4,html:"T"},9:{name:"Nine",index:5,html:"9"},8:{name:"Eight",index:6,html:"8"},7:{name:"Seven",index:7,html:"7"},6:{name:"Six",index:8,html:"6"},5:{name:"Five",index:9,html:"5"},4:{name:"Four",
index:10,html:"4"},3:{name:"Three",index:11,html:"3"},2:{name:"Two",index:12,html:"2"}},rankOrder:[],vulnerabilities:{"-":{name:"None",index:0,html:"None"},n:{name:"NS",index:0,html:"North-South"},e:{name:"EW",index:0,html:"East-West"},b:{name:"Both",index:0,html:"Both"}},_addKey:function(a){for(var b in a)a[b].key=b},_createIndexArray:function(a){var b=[],c;for(c in a)b[a[c].index]=c;return b},_checkListMembership:function(a,b,c,d){_.has(b,a)||Bridge._reportError(a+" is not a valid "+c,d)},_checkRequiredArgument:function(a,
b,c){a||""===a||Bridge._reportError("Required argument "+b+" has not been specified",c)}};Bridge._addKey(Bridge.directions);Bridge._addKey(Bridge.suits);Bridge._addKey(Bridge.calls);Bridge._addKey(Bridge.ranks);Bridge._addKey(Bridge.vulnerabilities);Bridge.directionOrder=Bridge._createIndexArray(Bridge.directions);Bridge.suitOrder=Bridge._createIndexArray(Bridge.suits);Bridge.callOrder=Bridge._createIndexArray(Bridge.calls);Bridge.rankOrder=Bridge._createIndexArray(Bridge.ranks);Bridge.options={useContextInErrorMessage:!1};
Bridge.getLHO=function(a){return Bridge.directions[a].lho};Bridge.getRHO=function(a){return Bridge.directions[a].rho};Bridge.getPartner=function(a){return Bridge.directions[a].cho};Bridge.areOpponents=function(a,b){return Bridge.getLHO(a)===b||Bridge.getRHO(a)===b};Bridge.arePartners=function(a,b){return Bridge.getPartner(a)===b};Bridge.isBid=function(a){return _.has(Bridge.calls,a)?Bridge.calls[a].bid:!1};Bridge.makeIdentifier=function(a){return a.trim().replace(/[^a-zA-Z0-9]+/g,"_")};
Bridge.assignDefault=function(a,b){return"undefined"===typeof a?b:a};Bridge.getHash=function(a){return Bridge._getParameters(location.hash,"#",a)};Bridge.getQuery=function(a){return Bridge._getQuery(document.URL,a)};Bridge._getQuery=function(a,b){return Bridge._getParameters(a,"?",b)};Bridge._getParameters=function(a,b,c){a=a.split(b);if(2>a.length)return{};a=a[1];c&&(a=a.split(c)[0]);return Bridge._parseParameterValues(a,"&","=")};
Bridge._parseParameterValues=function(a,b,c){b=Bridge.assignDefault(b,"&");c=Bridge.assignDefault(c,"=");var d={};a=a.trim();if(!a)return d;a=a.split(b);for(b=0;b<a.length;++b){var e=a[b].split(c);2>e.length?d[e]=!0:d[e[0]]=e[1]}return d};Bridge._parseContainedText=function(a,b,c,d){var e={};e.position=a.indexOf(c,b);-1===e.position&&Bridge._reportError("Ending delimiter "+c+" not found in "+a,d);e.text=a.slice(b+1,e.position);return e};
Bridge._reportError=function(a,b){if(!Bridge.options.useContextInErrorMessage)throw Error(a);throw Error((b?b+" - ":"")+a);};Bridge._checkDirection=function(a,b){Bridge._checkListMembership(a,Bridge.directions,"Direction",b)};Bridge._checkSuit=function(a,b){Bridge._checkListMembership(a,Bridge.suits,"Suit",b)};Bridge._checkCall=function(a,b){Bridge._checkListMembership(a,Bridge.calls,"Call",b)};
Bridge._checkLevel=function(a,b){var c=parseInt(a);(isNaN(c)||String(c)!==String(a)||1>c||7<c)&&Bridge._reportError(a+" is not a valid level",b)};Bridge._checkBid=function(a,b){(1>a.length||2<a.length)&&Bridge._reportError("Bid "+a+" does not have length 1 or 2",b);if(1===a.length){var c=a[0];Bridge._checkCall(c,b);Bridge.isBid(c)&&Bridge._reportError("Invalid bid "+a,b)}else{var d=a[0],c=a[1];Bridge._checkCall(c,b);Bridge.isBid(c)||Bridge._reportError("Invalid bid "+a,b);Bridge._checkLevel(d,b)}};
Bridge._checkRank=function(a,b){Bridge._checkListMembership(a,Bridge.ranks,"Rank",b)};Bridge._checkVulnerability=function(a,b){Bridge._checkListMembership(a,Bridge.vulnerabilities,"Vulnerability",b)};Bridge||(Bridge={});Bridge.Deal=function(){this._cardAssignedTo={};for(var a in Bridge.suits){this._cardAssignedTo[a]={};for(var b in Bridge.ranks)this._cardAssignedTo[a][b]=null}this.hands={};for(var c in Bridge.directions)this.hands[c]=new Bridge.Hand(c,this);this.board=1;this.vulnerability="-";this.dealer="n";this.scoring="KO";this.notes="";this.auction=new Bridge.Auction(this)};Bridge.Deal.prototype.getHand=function(a){Bridge._checkDirection(a);return this.hands[a]};
Bridge.Deal.prototype.getBoard=function(){return this.board};Bridge.Deal.prototype.setBoard=function(a){var b=parseInt(a);(isNaN(b)||String(b)!==String(a)||1>b)&&Bridge.Utilities.reportError(a+" is not a valid board number","In setBoard");this.board=b};Bridge.Deal.prototype.getDealer=function(){return this.dealer};Bridge.Deal.prototype.setDealer=function(a){a=a.toLowerCase();Bridge._checkDirection(a);this.dealer=a;this.getAuction().setDealer(a)};Bridge.Deal.prototype.getVulnerability=function(){return this.vulnerability};
Bridge.Deal.prototype.setVulnerability=function(a){a=a.toLowerCase();"0"===a&&(a="-");Bridge._checkVulnerability(a);this.vulnerability=a;this.getAuction().setVulnerability(a)};Bridge.Deal.prototype.getScoring=function(){return this.scoring};Bridge.Deal.prototype.setScoring=function(a){Bridge._checkRequiredArgument(a);this.scoring=a};Bridge.Deal.prototype.getNotes=function(){return this.notes};Bridge.Deal.prototype.setNotes=function(a){Bridge._checkRequiredArgument(a);this.notes=a};
Bridge.Deal.prototype.getAuction=function(){return this.auction};
Bridge.Deal.prototype.set=function(a,b){Bridge._checkRequiredArgument(a,"Property","In Bridge.Deal.prototype.set");Bridge._checkRequiredArgument(b,"Value for Property "+a,"In Bridge.Deal.prototype.set");switch(a){case "board":this.setBoard(b);break;case "vulnerability":this.setVulnerability(b);break;case "dealer":this.setDealer(b);break;case "scoring":this.setScoring(b);break;case "notes":this.setNotes(b);break;default:Bridge._reportError("Unknown deal property "+a,"In Bridge.Deal.prototype.set")}};
Bridge.Deal.prototype.get=function(a){Bridge._checkRequiredArgument(a,"Property","In Bridge.Deal.prototype.get - ");switch(a){case "board":return this.getBoard();case "vulnerability":return this.getVulnerability();case "dealer":return this.getDealer();case "scoring":return this.getScoring();case "notes":return this.getNotes();case "auction":return this.getAuction();default:Bridge._reportError("Unknown deal property "+a,"In Bridge.Deal.prototype.get - ")}};
Bridge.Deal.prototype.assignRest=function(){var a=[],b;for(b in Bridge.suits)for(var c in Bridge.ranks)this._cardAssignedTo[b][c]||a.push(b+c);if(!_.isEmpty(a)){var a=_.shuffle(a),d="n",e=null;_.each(a,function(a){for(;13===this.getHand(d).getCount();)e||(e=d),d=Bridge.getLHO(d),e===d&&Bridge._reportError("Unable to assign remaining cards");this.getHand(d).addCard(a[0],a[1])},this)}};
Bridge.Deal.prototype.fromString=function(a){var b={};_.each(a.split("&"),function(a){a=a.split("=");b[a[0]]=decodeURIComponent(a[1])});var c=0;_.each(b,function(a,b){switch(b){case "b":this.set("board",a);break;case "d":this.set("dealer",a);break;case "v":this.set("vulnerability",a);break;case "t":this.set("notes",a);break;case "a":var f=this.getAuction();"-"===a[0]?f.setContract(a.slice(1)):f.setAuction(a);break;case "n":case "e":case "s":case "w":f=this.getHand(b);f.setHand(a);13===f.getCount()&&
c++;break;case "nn":case "en":case "sn":case "wn":f=this.getHand(b[0]),f.setName(a)}},this);3===c&&this.assignRest()};
Bridge.Deal.prototype.toString=function(a){a=Bridge.assignDefault(a,!1);var b=[];this.board&&b.push("b="+this.getBoard());this.dealer&&b.push("d="+this.getDealer());this.vulnerability&&b.push("v="+this.getVulnerability());a&&this.notes&&b.push("t="+this.getNotes());for(var c in Bridge.directions)(a=this.getHand(c))&&b.push(c+"="+a),b.push(c+"n="+a.getName());this.auction&&b.push("a="+this.auction.toString());return b.join("&")};
Bridge.Deal.prototype.toJSON=function(){var a={version:"1.0"};_.each(["board","dealer","vulnerability","scoring","notes"],function(b){a[b]=this.get(b)},this);a.hands={};for(var b in Bridge.directions){var c=this.getHand(b);a.hands[b]=c.toJSON()}a.auction=this.auction.toJSON();return a};
Bridge.Deal.prototype.fromJSON=function(a){_.each(["board","dealer","vulnerability","scoring","notes"],function(b){_.has(a,b)&&this.set(b,a[b])},this);if(_.has(a,"hands"))for(var b in Bridge.directions)_.has(a.hands,b)&&this.getHand(b).fromJSON(a.hands[b]);_.has(a,"auction")&&this.auction.fromJSON(a.auction)};Bridge||(Bridge={});Bridge.Hand=function(a,b){Bridge._checkDirection(a);this.direction=a;this.deal=b;this.name=Bridge.directions[a].name;this.cards={};for(var c in Bridge.suits){this.cards[c]={};for(var d in Bridge.ranks)this.cards[c][d]=!1}this.numCards=0};Bridge.Hand.prototype.getDirection=function(){return this.direction};Bridge.Hand.prototype.setName=function(a){Bridge._checkRequiredArgument(a);this.name=a};Bridge.Hand.prototype.getName=function(){return this.name};
Bridge.Hand.prototype.getCount=function(){return this.numCards};Bridge.Hand.prototype.setHand=function(a){Bridge._checkRequiredArgument(a);this.fromString(a)};Bridge.Hand.prototype.getHand=function(){return this.toString()};
Bridge.Hand.prototype.addCard=function(a,b){Bridge._checkSuit(a,"In addCard");Bridge._checkRank(b,"In addCard");13===this.numCards&&Bridge._reportError(this.name+"'s Hand : already has 13 cards. Cannot add "+a+b,"In addCard");this.cards[a][b]&&Bridge._reportError(a+b+" is already assigned to "+this.direction+". Cannot add again","In addCard");if(this.deal){var c=this.deal._cardAssignedTo[a][b];c&&Bridge._reportError(a+b+" is already assigned to "+c+". Cannot add again","In addCard")}this.cards[a][b]=
!0;this.deal&&(this.deal._cardAssignedTo[a][b]=this.direction);this.numCards++};
Bridge.Hand.prototype.removeCard=function(a,b){Bridge._checkSuit(a,"In removeCard");Bridge._checkRank(b,"In removeCard");this.deal&&this.deal._cardAssignedTo[a][b]!==this.direction&&Bridge._reportError(a+b+" is not assigned to "+this.direction+". Cannot remove","In removeCard");this.cards[a][b]||Bridge._reportError(a+b+" is not assigned to "+this.direction+". Cannot remove","In removeCard");this.cards[a][b]=!1;this.numCards--;this.deal&&(this.deal._cardAssignedTo[a][b]=null)};
Bridge.Hand.prototype.hasCard=function(a,b){Bridge._checkSuit(a,"In hasCard");Bridge._checkRank(b,"In hasCard");return this.cards[a][b]};Bridge.Hand.prototype.clearCards=function(){for(var a in Bridge.suits)for(var b in Bridge.ranks)this.cards[a][b]&&this.removeCard(a,b)};
Bridge.Hand.prototype.set=function(a,b){Bridge._checkRequiredArgument(a,"Property","In Hand.set");Bridge._checkRequiredArgument(b,"Value for Property "+a,"In Hand.set");switch(a){case "name":this.setName(b);break;case "hand":this.setHand(b);break;default:Bridge._reportError("Unknown property "+a,"In Hand.set")}};
Bridge.Hand.prototype.get=function(a){Bridge._checkRequiredArgument(a,"Property","In Hand.get");switch(a){case "direction":return this.getDirection();case "name":return this.getName();case "count":return this.getCount();case "hand":return this.getHand();default:Bridge._reportError("Unknown property "+a,"In Hand.get")}};
Bridge.Hand.prototype.toString=function(){var a="";_.each(Bridge.suitOrder,function(b){var c="";_.each(Bridge.rankOrder,function(a){this.cards[b][a]&&(c+=a)},this);c&&(a+=b+c)},this);return a};
Bridge.Hand.prototype.fromString=function(a){Bridge._checkRequiredArgument(a);this.clearCards();var b={},c;for(c in Bridge.directions)b[c]=!1;a=a.toLowerCase();for(var d=c="",e=0;e<a.length;++e){var f="In hand for "+this.direction+" at position "+(e+1),d=a.charAt(e);switch(d){case "c":case "d":case "h":case "s":c=d;b[c]&&Bridge._reportError(" suit "+c+" has already been seen before!",f);b[c]=!0;break;case "1":""===c&&Bridge._reportError(d+" was found when a suit was expected!",f);if(e<a.length-1&&
"0"===a.charAt(e+1))d="t",e++;else{Bridge._reportError("a 1 is present without a subsequent 0. Use 10 or t to reprensent the ten.",f);continue}this.addCard(c,d);break;default:if(""===c){Bridge._reportError(d+" was found when a suit was expected!",f);continue}Bridge._checkRank(d,f);this.addCard(c,d)}}};Bridge.Hand.prototype.toJSON=function(){var a={};a.direction=this.direction;a.name=this.name;a.hand=this.getHand();return a};
Bridge.Hand.prototype.fromJSON=function(a){Bridge._checkRequiredArgument(a);this.name=a.name;this.setHand(a.hand)};Bridge||(Bridge={});Bridge.Call=function(a,b){Bridge._checkBid(a);Bridge._checkDirection(b);this.call=a;this.direction=b;this.explanation=this.annotation=""};Bridge.Call.prototype.getCall=function(){return this.call};Bridge.Call.prototype.getLevel=function(){return 1===this.call.length?0:_.parseInt(this.call[0])};Bridge.Call.prototype.getSuit=function(){return 1===this.call.length?this.call[0]:this.call[1]};Bridge.Call.prototype.setDirection=function(a){Bridge._checkDirection(a);this.direction=a};
Bridge.Call.prototype.getDirection=function(){return this.direction};Bridge.Call.prototype.getAnnotation=function(){return this.annotation};Bridge.Call.prototype.setAnnotation=function(a){Bridge._checkRequiredArgument(a);this.annotation=a};Bridge.Call.prototype.getExplanation=function(){return this.explanation};Bridge.Call.prototype.setExplanation=function(a){Bridge._checkRequiredArgument(a);this.explanation=a};
Bridge.Call.prototype.set=function(a,b){Bridge._checkRequiredArgument(a,"Property","In Call.set");Bridge._checkRequiredArgument(b,"Value for Property "+a,"In Call.set");switch(a){case "direction":this.setDirection(b);break;case "annotation":this.setAnnotation(b);break;case "explanation":this.setExplanation(b);break;default:Bridge._reportError("Unknown property "+a,"In Call.set")}};
Bridge.Call.prototype.get=function(a){Bridge._checkRequiredArgument(a,"Property","In Call.get");switch(a){case "call":return this.getCall();case "direction":return this.getDirection();case "annotation":return this.getAnnotation();case "explanation":return this.getExplanation();default:Bridge._reportError("Unknown property "+a,"In Call.get")}};
Bridge.Call.prototype.toString=function(){var a;a=""+this.call;this.explanation&&(a+="{"+this.explanation+"}");this.annotation&&(a+="("+this.annotation+")");return a};Bridge||(Bridge={});Bridge.Auction=function(a){this.dealer=(this.deal=a)?a.getDealer():"n";this.vulnerability=a?a.getVulnerability():"-";this.nextToCall=this.dealer;this.calls=[];this.contracts=[]};Bridge.Auction.prototype.getDealer=function(){return this.dealer};Bridge.Auction.prototype.setDealer=function(a){Bridge._checkDirection(a);var b=this.dealer=a;_.each(this.calls,function(a){a.setDirection(b);b=Bridge.getLHO(b)},this);this.nextToCall=b};Bridge.Auction.prototype.getVulnerability=function(){return this.vulnerability};
Bridge.Auction.prototype.setVulnerability=function(a){Bridge._checkVulnerability(a);this.vulnerability=a};Bridge.Auction.prototype.setAuction=function(a){Bridge._checkRequiredArgument(a);this.fromString(a)};Bridge.Auction.prototype.getAuction=function(){return this.toString()};
Bridge.Auction.prototype.setContract=function(a){Bridge._checkRequiredArgument(a);var b=0;a.length<b+1&&Bridge._reportError("Contract string "+a+" does not specify level!","In Bridge.setContract");var c=_.parseInt(a[b++]);a.length<b+1&&Bridge._reportError("Contract string "+a+" does not specify suit!","In Bridge.setContract");var d=a[b++].toLowerCase();Bridge._checkBid(c+d,"In Bridge.setContract");Bridge.isBid(d)||Bridge._reportError("Contract string "+a+" does not specify a valid suit!","In Bridge.setContract");
var e=!1,f=!1;a.length>b&&"x"===a[b].toLowerCase()&&(e=!0,b++,a.length>b&&"x"===a[b].toLowerCase()&&(f=!0,b++));a.length<b+1&&Bridge._reportError("Contract string "+a+" does not specify declarer!","In Bridge.setContract");a=a[b].toLowerCase();Bridge._checkDirection(a);for(this.clearCalls();this.nextToCall!==a;)this.addCall("p");this.addCall(c+d);e&&this.addCall("x");f&&this.addCall("r");this.addCall("p");this.addCall("p");this.addCall("p")};
Bridge.Auction.prototype.getContract=function(){var a=this.calls.length;return 0===a?new Bridge.Contract:this.contracts[a-1]};Bridge.Auction.prototype.get=function(a){Bridge._checkRequiredArgument(a,"Property","In Auction.get");switch(a){case "dealer":return this.getDealer();case "vulnerability":return this.getVulnerability();case "contract":return this.getContract();case "auction":return this.getAuction();default:Bridge._reportError("Unknown deal property "+a,"In Auction.get")}};
Bridge.Auction.prototype.set=function(a,b){Bridge._checkRequiredArgument(a,"Property","In Auction.set");Bridge._checkRequiredArgument(b,"Value for Property "+a,"In Auction.set");switch(a){case "dealer":this.setDealer(b);break;case "vulnerability":this.setVulnerability(b);break;case "contract":this.setContract(b);break;case "auction":this.setAuction(b);break;default:Bridge._reportError("Unknown deal property "+a,"In Auction.set")}};
Bridge.Auction.prototype.addCall=function(a,b,c){Bridge._checkBid(a,"In Auction.addCall");a=new Bridge.Call(a,this.nextToCall);c&&a.setAnnotation(c);b&&a.setExplanation(b);b=0===this.calls.length?new Bridge.Contract:this.getContract().clone();b.update(a);this.calls.push(a);this.contracts.push(b);this.nextToCall=Bridge.getLHO(this.nextToCall)};Bridge.Auction.prototype.addAllPass=function(){for(;!this.getContract().isComplete;)this.addCall("p")};
Bridge.Auction.prototype.clearCalls=function(){this.calls=[];this.contracts=[];this.nextToCall=this.dealer};Bridge.Auction.prototype.removeCall=function(){0<this.calls.length&&(this.calls.pop(),this.contracts.pop(),this.nextToCall=Bridge.getRHO(this.nextToCall))};
Bridge.Auction.prototype.fromString=function(a){this.clearCalls();for(var b=0;b<a.length;){for(var c=a[b++].toLowerCase(),c=_.has(Bridge.calls,c)&&!Bridge.isBid(c)?c:c+a[b++].toLowerCase(),d=null,e=null;b<a.length&&("("===a[b]||"{"===a[b]);){if("("===a[b])var f=")",b=Bridge._parseContainedText(a,b,f,"In Auction.fromString"),e=b.text;else f="}",b=Bridge._parseContainedText(a,b,f,"In Auction.fromString"),d=b.text;b=b.position+1}this.addCall(c,d,e)}};Bridge.Auction.prototype.fromJSON=function(a){return this.fromString(a)};
Bridge.Auction.prototype.toString=function(){for(var a="",b=0;b<this.calls.length;++b)a+=this.calls[b].toString();return a};Bridge.Auction.prototype.toJSON=function(){return this.toString()};Bridge||(Bridge={});Bridge.Contract=function(){this.suit=this.level=null;this.redoubled=this.doubled=!1;this.declarer=null;this.firstToBid={};for(var a in Bridge.calls)if(Bridge.isBid(a)){this.firstToBid[a]={};for(var b in Bridge.directions)this.firstToBid[a][b]=null}this.numPasses=0;this.isComplete=!1};
Bridge.Contract.prototype.allowedCalls=function(a){Bridge._checkDirection(a);var b={};b.p=!this.isComplete;b.x=!1;b.r=!1;for(var c=1;7>=c;++c)for(var d in Bridge.calls)Bridge.isBid(d)&&(b[c+d]=!this.isComplete);b.u=!(null===this.suit&&0===this.numPasses);if(null===this.suit||this.isComplete)return b;for(c=1;7>=c;++c)for(d in Bridge.calls)Bridge.isBid(d)&&(b[c+d]=c>this.level||c===this.level&&Bridge.calls[d].index<Bridge.calls[this.suit].index?!0:!1);b.p=!0;b.x=!this.doubled&&!this.redoubled&&Bridge.areOpponents(a,
this.declarer);b.r=this.doubled&&!this.redoubled&&!Bridge.areOpponents(a,this.declarer);return b};Bridge.Contract.prototype.clone=function(){var a=new Bridge.Contract;_.each("level suit doubled redoubled declarer numPasses isComplete".split(" "),function(b){a[b]=this[b]},this);a.firstToBid=_.cloneDeep(this.firstToBid);return a};
Bridge.Contract.prototype.update=function(a){this.isComplete&&Bridge._reportError("Auction is already complete. Cannot make another call");var b=a.getLevel(),c=a.getSuit(),d=a.getDirection();switch(c){case "p":this.numPasses++;if(this.declarer&&3===this.numPasses||4===this.numPasses)this.isComplete=!0;break;case "x":this.declarer&&Bridge.areOpponents(this.declarer,d)&&!this.redoubled&&!this.doubled||Bridge._reportError("Double is not allowed at this point in the auction");this.doubled=!0;this.numPasses=
0;break;case "r":(!this.doubled||Bridge.areOpponents(this.declarer,d)||this.redoubled)&&Bridge._reportError("ReDouble is not allowed at this point in the auction");this.redoubled=!0;this.numPasses=0;break;default:(b<this.level||b===this.level&&Bridge.calls[c].index>=Bridge.calls[this.suit].index)&&Bridge._reportError(a.toString()+" is not allowed at this point in the auction"),this.redoubled=this.doubled=!1,this.numPasses=0,this.firstToBid[c][d]||(this.firstToBid[c][d]=d,this.firstToBid[c][Bridge.getPartner(d)]=
d),this.declarer=this.firstToBid[c][d],this.suit=c,this.level=b}};Bridge.Contract.prototype.toString=function(){var a="";this.level&&(a+=this.level,a+=this.suit,this.redoubled?a+="xx":this.doubled&&(a+="x"),a+=this.declarer);return a};Bridge.Deal.prototype.toHTML=function(){var a;a="<h3>Deal Information</h3>"+("Board : "+this.getBoard()+"<br/>");a+="Dealer : "+Bridge.directions[this.getDealer()].html+"<br/>";a+="Vulnerability : "+Bridge.vulnerabilities[this.getVulnerability()].html+"<br/>";a+="Notes : "+this.getNotes()+"<br/>";a+="<h3>Hands</h3>";for(var b in Bridge.directions)a+=this.getHand(b).toHTML()+"<br/>";a+="<h3>Auction</h3>";return a+=this.getAuction().toHTML()};
Bridge.Hand.prototype.toHTML=function(a){a=Bridge.assignDefault(a,!1);var b="";a&&(b+="Direction : "+Bridge.directions[this.direction].html,b+=", Name : "+this.name+" - ");_.each(Bridge.suitOrder,function(a){var d="";_.each(Bridge.rankOrder,function(b){this.cards[a][b]&&(d+=Bridge.ranks[b].html)},this);b=d?b+(Bridge.suits[a].html+" "+d+" "):b+(Bridge.suits[a].html+" ")},this);return b};
Bridge.Auction.prototype.toHTML=function(){for(var a="Auction: ",b=0;b<this.calls.length;++b)a+=this.calls[b].toHTML()+" ";return a+="<br/>Contract: "+this.getContract().toHTML()};
Bridge.Auction.prototype.toHTMLTable=function(a){a=Bridge.assignDefault(a,"auction-table");var b="",c="";if("n"===this.vulnerability||"b"===this.vulnerability)c=" style='background-color:#cc0000;' ";if("e"===this.vulnerability||"b"===this.vulnerability)b=" style='background-color:#cc0000;' ";a="<table id='"+a+"'><thead id='auction-table-header'><tr>";a+="<th"+b+">W</th>";a+="<th"+c+">N</th>";a+="<th"+b+">E</th>";a+="<th"+c+">S</th>";a+="</tr></thead>";a+="<tbody id='auction-table-body'><tr>";b="w";
for(c=!0;this.dealer!==b;)c=!1,b=Bridge.getLHO(b),a+="<td>-</td>";for(var d=0;d<this.calls.length;++d){var e=this.calls[d],b=e.getDirection();"w"===b&&(c||(a+="</tr><tr>"));a+="<td>"+e.toHTML()+"</td>";c=!1}0<this.calls.length&&(b=Bridge.getLHO(b));this.getContract().isComplete||("w"===b&&(a+="</tr><tr>"),a+="<td>?</td>",b=Bridge.getLHO(b));for(;"w"!==b;)a+="<td></td>",b=Bridge.getLHO(b);return a+="</tr></tbody></table>"};
Bridge.Call.prototype.toHTML=function(a){a="";return a=1===this.call.length?a+Bridge.calls[this.call].html:a+(this.call[0]+Bridge.calls[this.call[1]].html)};Bridge.Contract.prototype.toHTML=function(){var a="";this.level&&(a+=this.level,a+=Bridge.calls[this.suit].html,this.redoubled?a+=Bridge.calls.r.html:this.doubled&&(a+=Bridge.calls.x.html),a+=" by "+Bridge.directions[this.declarer].html);return a};
