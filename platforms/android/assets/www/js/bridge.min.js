'use strict';var Bridge={directions:{n:{name:"North",lho:"e",rho:"w",cho:"s",index:1,html:"North"},e:{name:"East",lho:"s",rho:"n",cho:"w",index:2,html:"East"},s:{name:"South",lho:"w",rho:"e",cho:"n",index:3,html:"South"},w:{name:"West",lho:"n",rho:"s",cho:"e",index:0,html:"West"}},directionOrder:[],suits:{s:{name:"Spades",index:0,html:'<font color="000000">&spades;</font>'},h:{name:"Hearts",index:1,html:'<font color="CB0000">&hearts;</font>'},d:{name:"Diamonds",index:2,html:'<font color="CB0000">&diams;</font>'},
c:{name:"Clubs",index:3,html:'<font color="000000">&clubs;</font>'}},suitOrder:[],calls:{n:{name:"No Trump",index:0,bid:!0,text:"NT",html:'<font color="000000">NT</font>'},s:{name:"Spades",index:1,bid:!0,text:"&spades;",html:'<font color="000000">&spades;</font>'},h:{name:"Hearts",index:2,bid:!0,text:"&hearts;",html:'<font color="CB0000">&hearts;</font>'},d:{name:"Diamonds",index:3,bid:!0,text:"&diams;",html:'<font color="CB0000">&diams;</font>'},c:{name:"Clubs",index:4,bid:!0,text:"&clubs;",html:'<font color="000000">&clubs;</font>'},
p:{name:"Pass",index:7,bid:!1,text:"P",html:'<font color="green">P</font>'},x:{name:"Double",index:6,bid:!1,text:"X",html:'<font color="red">X</font>'},r:{name:"Redouble",index:5,bid:!1,text:"XX",html:'<font color="blue">XX<font>'}},callOrder:[],ranks:{a:{name:"Ace",index:0,html:"A"},k:{name:"King",index:1,html:"K"},q:{name:"Queen",index:2,html:"Q"},j:{name:"Jack",index:3,html:"J"},t:{name:"Ten",index:4,html:"T"},9:{name:"Nine",index:5,html:"9"},8:{name:"Eight",index:6,html:"8"},7:{name:"Seven",index:7,
html:"7"},6:{name:"Six",index:8,html:"6"},5:{name:"Five",index:9,html:"5"},4:{name:"Four",index:10,html:"4"},3:{name:"Three",index:11,html:"3"},2:{name:"Two",index:12,html:"2"}},rankOrder:[],vulnerabilities:{"-":{name:"None",index:0,html:"None"},n:{name:"NS",index:0,html:"North-South"},e:{name:"EW",index:0,html:"East-West"},b:{name:"Both",index:0,html:"Both"}},_addKey:function(a){for(var b in a)a[b].key=b},_createIndexArray:function(a){var b=[],d;for(d in a)b[a[d].index]=d;return b},_checkListMembership:function(a,
b,d,c){_.has(b,a)||Bridge._reportError(a+" is not a valid "+d,c)},_checkRequiredArgument:function(a,b,d){a||""===a||Bridge._reportError("Required argument "+b+" has not been specified",d)}};Bridge._addKey(Bridge.directions);Bridge._addKey(Bridge.suits);Bridge._addKey(Bridge.calls);Bridge._addKey(Bridge.ranks);Bridge._addKey(Bridge.vulnerabilities);Bridge.directionOrder=Bridge._createIndexArray(Bridge.directions);Bridge.suitOrder=Bridge._createIndexArray(Bridge.suits);Bridge.callOrder=Bridge._createIndexArray(Bridge.calls);
Bridge.rankOrder=Bridge._createIndexArray(Bridge.ranks);Bridge.options={useContextInErrorMessage:!1,enableDebug:!1};Bridge.getLHO=function(a){return Bridge.directions[a].lho};Bridge.getRHO=function(a){return Bridge.directions[a].rho};Bridge.getPartner=function(a){return Bridge.directions[a].cho};Bridge.areOpponents=function(a,b){return Bridge.getLHO(a)===b||Bridge.getRHO(a)===b};Bridge.arePartners=function(a,b){return Bridge.getPartner(a)===b};
Bridge.isBid=function(a){return _.has(Bridge.calls,a)?Bridge.calls[a].bid:!1};Bridge.makeIdentifier=function(a){return a.trim().replace(/[^a-zA-Z0-9]+/g,"_")};Bridge.assignDefault=function(a,b){return"undefined"===typeof a?b:a};Bridge.getHash=function(a){return Bridge._getParameters(location.hash,"#",a)};Bridge.getQuery=function(a){return Bridge._getQuery(document.URL,a)};Bridge._getQuery=function(a,b){return Bridge._getParameters(a,"?",b)};
Bridge._getParameters=function(a,b,d){a=a.split(b);if(2>a.length)return{};a=a[1];d&&(a=a.split(d)[0]);return Bridge._parseParameterValues(a,"&","=")};Bridge._parseParameterValues=function(a,b,d){b=Bridge.assignDefault(b,"&");d=Bridge.assignDefault(d,"=");var c={};a=a.trim();if(!a)return c;a=a.split(b);for(b=0;b<a.length;++b){var e=a[b].split(d);2>e.length?c[e]=!0:c[e[0]]=e[1]}return c};
Bridge._parseContainedText=function(a,b,d,c){var e={};e.position=a.indexOf(d,b);-1===e.position&&Bridge._reportError("Ending delimiter "+d+" not found in "+a,c);e.text=a.slice(b+1,e.position);return e};Bridge._reportError=function(a,b){if(!Bridge.options.useContextInErrorMessage)throw Error(a);throw Error((b?b+" - ":"")+a);};Bridge._checkDirection=function(a,b){Bridge._checkListMembership(a,Bridge.directions,"Direction",b)};
Bridge._checkSuit=function(a,b){Bridge._checkListMembership(a,Bridge.suits,"Suit",b)};Bridge._checkCall=function(a,b){Bridge._checkListMembership(a,Bridge.calls,"Call",b)};Bridge._checkLevel=function(a,b){var d=parseInt(a);(isNaN(d)||String(d)!==String(a)||1>d||7<d)&&Bridge._reportError(a+" is not a valid level",b)};
Bridge._checkBid=function(a,b){(1>a.length||2<a.length)&&Bridge._reportError("Bid "+a+" does not have length 1 or 2",b);if(1===a.length){var d=a[0];Bridge._checkCall(d,b);Bridge.isBid(d)&&Bridge._reportError("Invalid bid "+a,b)}else{var c=a[0],d=a[1];Bridge._checkCall(d,b);Bridge.isBid(d)||Bridge._reportError("Invalid bid "+a,b);Bridge._checkLevel(c,b)}};Bridge._checkRank=function(a,b){Bridge._checkListMembership(a,Bridge.ranks,"Rank",b)};
Bridge._checkVulnerability=function(a,b){Bridge._checkListMembership(a,Bridge.vulnerabilities,"Vulnerability",b)};Bridge||(Bridge={});Bridge.Deal=function(){this._cardAssignedTo={};for(var a in Bridge.suits){this._cardAssignedTo[a]={};for(var b in Bridge.ranks)this._cardAssignedTo[a][b]=null}this.hands={};for(var d in Bridge.directions)this.hands[d]=new Bridge.Hand(d,this);this._activeHand="n";this.board=1;this.vulnerability="-";this.dealer="n";this.scoring="KO";this.notes="";this.auction=new Bridge.Auction(this);this.triggerEvents=!0};Bridge.Deal.prototype.enableEventTrigger=function(){this.triggerEvents=!0};
Bridge.Deal.prototype.disableEventTrigger=function(){this.triggerEvents=!1};Bridge.Deal.prototype.getHand=function(a){Bridge._checkDirection(a);return this.hands[a]};Bridge.Deal.prototype.getActiveHand=function(){return this._activeHand};Bridge.Deal.prototype.setActiveHand=function(a){Bridge._checkDirection(a);this.getHand(this.getActiveHand()).makeInactive();this._activeHand=a;this.getHand(a).makeActive();this.onChange("setActiveHand",a)};Bridge.Deal.prototype.getBoard=function(){return this.board};
Bridge.Deal.prototype.setBoard=function(a){var b=parseInt(a);(isNaN(b)||String(b)!==String(a)||1>b)&&Bridge.Utilities.reportError(a+" is not a valid board number","In setBoard");this.board=b;this.onChange("setBoard",this.board)};Bridge.Deal.prototype.getDealer=function(){return this.dealer};Bridge.Deal.prototype.setDealer=function(a){a=a.toLowerCase();Bridge._checkDirection(a);this.dealer=a;this.getAuction().setDealer(a);this.onChange("setDealer",a)};Bridge.Deal.prototype.getVulnerability=function(){return this.vulnerability};
Bridge.Deal.prototype.setVulnerability=function(a){a=a.toLowerCase();"0"===a&&(a="-");Bridge._checkVulnerability(a);this.vulnerability=a;this.getAuction().setVulnerability(a);this.onChange("setVulnerability",a)};Bridge.Deal.prototype.getScoring=function(){return this.scoring};Bridge.Deal.prototype.setScoring=function(a){Bridge._checkRequiredArgument(a);this.scoring=a;this.onChange("setScoring",a)};Bridge.Deal.prototype.getNotes=function(){return this.notes};
Bridge.Deal.prototype.setNotes=function(a){Bridge._checkRequiredArgument(a);this.notes=a;this.onChange("setNotes",a)};Bridge.Deal.prototype.getAuction=function(){return this.auction};
Bridge.Deal.prototype.set=function(a,b){Bridge._checkRequiredArgument(a,"Property","In Bridge.Deal.prototype.set");Bridge._checkRequiredArgument(b,"Value for Property "+a,"In Bridge.Deal.prototype.set");switch(a){case "board":this.setBoard(b);break;case "vulnerability":this.setVulnerability(b);break;case "dealer":this.setDealer(b);break;case "scoring":this.setScoring(b);break;case "notes":this.setNotes(b);break;default:Bridge._reportError("Unknown deal property "+a,"In Bridge.Deal.prototype.set")}};
Bridge.Deal.prototype.get=function(a){Bridge._checkRequiredArgument(a,"Property","In Bridge.Deal.prototype.get - ");switch(a){case "board":return this.getBoard();case "vulnerability":return this.getVulnerability();case "dealer":return this.getDealer();case "scoring":return this.getScoring();case "notes":return this.getNotes();case "auction":return this.getAuction();default:Bridge._reportError("Unknown deal property "+a,"In Bridge.Deal.prototype.get - ")}};
Bridge.Deal.prototype.assignRest=function(){var a=[],b;for(b in Bridge.suits)for(var d in Bridge.ranks)this._cardAssignedTo[b][d]||a.push(b+d);if(!_.isEmpty(a)){var a=_.shuffle(a),c="n",e=null;_.each(a,function(a){for(;13===this.getHand(c).getCount();)e||(e=c),c=Bridge.getLHO(c),e===c&&Bridge._reportError("Unable to assign remaining cards");this.getHand(c).addCard(a[0],a[1])},this)}};
Bridge.Deal.prototype.fromString=function(a){var b={};_.each(a.split("&"),function(a){a=a.split("=");b[a[0]]=decodeURIComponent(a[1])});var d=0;_.each(b,function(a,b){switch(b){case "b":this.set("board",a);break;case "d":this.set("dealer",a);break;case "v":this.set("vulnerability",a);break;case "t":this.set("notes",a);break;case "a":var f=this.getAuction();"-"===a[0]?f.setContract(a.slice(1)):f.setAuction(a);break;case "n":case "e":case "s":case "w":f=this.getHand(b);f.setHand(a);13===f.getCount()&&
d++;break;case "nn":case "en":case "sn":case "wn":f=this.getHand(b[0]),f.setName(a)}},this);3===d&&this.assignRest()};
Bridge.Deal.prototype.toString=function(a){a=Bridge.assignDefault(a,!1);var b=[];this.board&&b.push("b="+this.getBoard());this.dealer&&b.push("d="+this.getDealer());this.vulnerability&&b.push("v="+this.getVulnerability());a&&this.notes&&b.push("t="+this.getNotes());for(var d in Bridge.directions)(a=this.getHand(d))&&b.push(d+"="+a),b.push(d+"n="+a.getName());this.auction&&b.push("a="+this.auction.toString());return b.join("&")};
Bridge.Deal.prototype.toJSON=function(){var a={version:"1.0"};_.each(["board","dealer","vulnerability","scoring","notes"],function(b){a[b]=this.get(b)},this);a.hands={};for(var b in Bridge.directions){var d=this.getHand(b);a.hands[b]=d.toJSON()}a.auction=this.auction.toJSON();return a};
Bridge.Deal.prototype.fromJSON=function(a){_.each(["board","dealer","vulnerability","scoring","notes"],function(b){_.has(a,b)&&this.set(b,a[b])},this);if(_.has(a,"hands"))for(var b in Bridge.directions)_.has(a.hands,b)&&this.getHand(b).fromJSON(a.hands[b]);_.has(a,"auction")&&this.auction.fromJSON(a.auction)};Bridge.Deal.prototype.onChange=function(a,b){this.triggerEvents&&(Bridge.options.enableDebug&&console.log("deal:changed "+a+" - "+b),$(document).trigger("deal:changed",[this,a,b]))};Bridge||(Bridge={});Bridge.Hand=function(a,b){Bridge._checkDirection(a);this.direction=a;this.deal=b;this.name=Bridge.directions[a].name;this.cards={};for(var d in Bridge.suits){this.cards[d]={};for(var c in Bridge.ranks)this.cards[d][c]=!1}this.numCards=0;this._isActive=!1;this.triggerEvents=!0};Bridge.Deal.prototype.enableEventTrigger=function(){this.triggerEvents=!0};Bridge.Deal.prototype.disableEventTrigger=function(){this.triggerEvents=!1};
Bridge.Hand.prototype.makeActive=function(){this._isActive=!0;this.onChange("makeActive")};Bridge.Hand.prototype.makeInactive=function(){this._isActive=!1;this.onChange("makeInactive")};Bridge.Hand.prototype.getDirection=function(){return this.direction};Bridge.Hand.prototype.setName=function(a){Bridge._checkRequiredArgument(a);this.name=a;this.onChange("setName",a)};Bridge.Hand.prototype.getName=function(){return this.name};Bridge.Hand.prototype.getCount=function(){return this.numCards};
Bridge.Hand.prototype.setHand=function(a){Bridge._checkRequiredArgument(a);this.fromString(a)};Bridge.Hand.prototype.getHand=function(){return this.toString()};
Bridge.Hand.prototype.addCard=function(a,b){Bridge._checkSuit(a,"In addCard");Bridge._checkRank(b,"In addCard");13===this.numCards&&Bridge._reportError(this.name+"'s Hand : already has 13 cards. Cannot add "+a+b,"In addCard");this.cards[a][b]&&Bridge._reportError(a+b+" is already assigned to "+this.direction+". Cannot add again","In addCard");if(this.deal){var d=this.deal._cardAssignedTo[a][b];d&&Bridge._reportError(a+b+" is already assigned to "+d+". Cannot add again","In addCard")}this.cards[a][b]=
!0;this.deal&&(this.deal._cardAssignedTo[a][b]=this.direction);this.numCards++;this.onChange("addCard",a+b)};
Bridge.Hand.prototype.removeCard=function(a,b){Bridge._checkSuit(a,"In removeCard");Bridge._checkRank(b,"In removeCard");this.deal&&this.deal._cardAssignedTo[a][b]!==this.direction&&Bridge._reportError(a+b+" is not assigned to "+this.direction+". Cannot remove","In removeCard");this.cards[a][b]||Bridge._reportError(a+b+" is not assigned to "+this.direction+". Cannot remove","In removeCard");this.cards[a][b]=!1;this.numCards--;this.deal&&(this.deal._cardAssignedTo[a][b]=null);this.onChange("removeCard",
a+b)};Bridge.Hand.prototype.hasCard=function(a,b){Bridge._checkSuit(a,"In hasCard");Bridge._checkRank(b,"In hasCard");return this.cards[a][b]};Bridge.Hand.prototype.clearCards=function(){for(var a in Bridge.suits)for(var b in Bridge.ranks)this.cards[a][b]&&this.removeCard(a,b)};
Bridge.Hand.prototype.set=function(a,b){Bridge._checkRequiredArgument(a,"Property","In Hand.set");Bridge._checkRequiredArgument(b,"Value for Property "+a,"In Hand.set");switch(a){case "name":this.setName(b);break;case "hand":this.setHand(b);break;default:Bridge._reportError("Unknown property "+a,"In Hand.set")}};
Bridge.Hand.prototype.get=function(a){Bridge._checkRequiredArgument(a,"Property","In Hand.get");switch(a){case "direction":return this.getDirection();case "name":return this.getName();case "count":return this.getCount();case "hand":return this.getHand();default:Bridge._reportError("Unknown property "+a,"In Hand.get")}};
Bridge.Hand.prototype.toString=function(){var a="";_.each(Bridge.suitOrder,function(b){var d="";_.each(Bridge.rankOrder,function(a){this.cards[b][a]&&(d+=a)},this);d&&(a+=b+d)},this);return a};
Bridge.Hand.prototype.fromString=function(a){Bridge._checkRequiredArgument(a);this.clearCards();var b={},d;for(d in Bridge.directions)b[d]=!1;a=a.toLowerCase();for(var c=d="",e=0;e<a.length;++e){var f="In hand for "+this.direction+" at position "+(e+1),c=a.charAt(e);switch(c){case "c":case "d":case "h":case "s":d=c;b[d]&&Bridge._reportError(" suit "+d+" has already been seen before!",f);b[d]=!0;break;case "1":""===d&&Bridge._reportError(c+" was found when a suit was expected!",f);if(e<a.length-1&&
"0"===a.charAt(e+1))c="t",e++;else{Bridge._reportError("a 1 is present without a subsequent 0. Use 10 or t to reprensent the ten.",f);continue}this.addCard(d,c);break;default:if(""===d){Bridge._reportError(c+" was found when a suit was expected!",f);continue}Bridge._checkRank(c,f);this.addCard(d,c)}}};Bridge.Hand.prototype.toJSON=function(){var a={};a.direction=this.direction;a.name=this.name;a.hand=this.getHand();return a};
Bridge.Hand.prototype.fromJSON=function(a){Bridge._checkRequiredArgument(a);this.name=a.name;this.setHand(a.hand)};Bridge.Hand.prototype.onChange=function(a,b){if(this.triggerEvents&&!this.deal||this.deal.triggerEvents)Bridge.options.enableDebug&&console.log("hand:changed "+a+" - "+b),$(document).trigger("hand:changed",[this,a,b]);this.deal&&this.deal.triggerEvents&&(Bridge.options.enableDebug&&console.log("deal:changed "+a+" - "+b),$(document).trigger("deal:changed",[this.deal,a,b]))};Bridge||(Bridge={});Bridge.Call=function(a,b){Bridge._checkBid(a);Bridge._checkDirection(b);this.call=a;this.direction=b;this.explanation=this.annotation=""};Bridge.Call.prototype.getCall=function(){return this.call};Bridge.Call.prototype.getLevel=function(){return 1===this.call.length?0:_.parseInt(this.call[0])};Bridge.Call.prototype.getSuit=function(){return 1===this.call.length?this.call[0]:this.call[1]};Bridge.Call.prototype.setDirection=function(a){Bridge._checkDirection(a);this.direction=a};
Bridge.Call.prototype.getDirection=function(){return this.direction};Bridge.Call.prototype.getAnnotation=function(){return this.annotation};Bridge.Call.prototype.setAnnotation=function(a){Bridge._checkRequiredArgument(a);this.annotation=a};Bridge.Call.prototype.getExplanation=function(){return this.explanation};Bridge.Call.prototype.setExplanation=function(a){Bridge._checkRequiredArgument(a);this.explanation=a};
Bridge.Call.prototype.set=function(a,b){Bridge._checkRequiredArgument(a,"Property","In Call.set");Bridge._checkRequiredArgument(b,"Value for Property "+a,"In Call.set");switch(a){case "direction":this.setDirection(b);break;case "annotation":this.setAnnotation(b);break;case "explanation":this.setExplanation(b);break;default:Bridge._reportError("Unknown property "+a,"In Call.set")}};
Bridge.Call.prototype.get=function(a){Bridge._checkRequiredArgument(a,"Property","In Call.get");switch(a){case "call":return this.getCall();case "direction":return this.getDirection();case "annotation":return this.getAnnotation();case "explanation":return this.getExplanation();default:Bridge._reportError("Unknown property "+a,"In Call.get")}};
Bridge.Call.prototype.toString=function(){var a;a=""+this.call;this.explanation&&(a+="{"+this.explanation+"}");this.annotation&&(a+="("+this.annotation+")");return a};Bridge||(Bridge={});Bridge.Auction=function(a){this.dealer=(this.deal=a)?a.getDealer():"n";this.vulnerability=a?a.getVulnerability():"-";this.nextToCall=this.dealer;this.calls=[];this.contracts=[];this.selectedLevel=0};Bridge.Auction.prototype.getDealer=function(){return this.dealer};
Bridge.Auction.prototype.setDealer=function(a){Bridge._checkDirection(a);var b=this.dealer=a;_.each(this.calls,function(a){a.setDirection(b);b=Bridge.getLHO(b)},this);this.nextToCall=b;this.onChange("changed dealer to "+a)};Bridge.Auction.prototype.getVulnerability=function(){return this.vulnerability};Bridge.Auction.prototype.setVulnerability=function(a){Bridge._checkVulnerability(a);this.vulnerability=a;this.onChange("setVulnerability",a)};Bridge.Auction.prototype.getSelectedLevel=function(){return this.selectedLevel};
Bridge.Auction.prototype.setSelectedLevel=function(a){Bridge._checkLevel(a);this.selectedLevel=a;this.onChange("setSelectedLevel",a)};Bridge.Auction.prototype.setAuction=function(a){Bridge._checkRequiredArgument(a);this.fromString(a)};Bridge.Auction.prototype.getAuction=function(){return this.toString()};
Bridge.Auction.prototype.setContract=function(a){Bridge._checkRequiredArgument(a);var b=0;a.length<b+1&&Bridge._reportError("Contract string "+a+" does not specify level!","In Bridge.setContract");var d=_.parseInt(a[b++]);a.length<b+1&&Bridge._reportError("Contract string "+a+" does not specify suit!","In Bridge.setContract");var c=a[b++].toLowerCase();Bridge._checkBid(d+c,"In Bridge.setContract");Bridge.isBid(c)||Bridge._reportError("Contract string "+a+" does not specify a valid suit!","In Bridge.setContract");
var e=!1,f=!1;a.length>b&&"x"===a[b].toLowerCase()&&(e=!0,b++,a.length>b&&"x"===a[b].toLowerCase()&&(f=!0,b++));a.length<b+1&&Bridge._reportError("Contract string "+a+" does not specify declarer!","In Bridge.setContract");a=a[b].toLowerCase();Bridge._checkDirection(a);for(this.clearCalls();this.nextToCall!==a;)this.addCall("p");this.addCall(d+c);e&&this.addCall("x");f&&this.addCall("r");this.addCall("p");this.addCall("p");this.addCall("p")};
Bridge.Auction.prototype.getContract=function(){var a=this.calls.length;return 0===a?new Bridge.Contract:this.contracts[a-1]};
Bridge.Auction.prototype.get=function(a){Bridge._checkRequiredArgument(a,"Property","In Auction.get");switch(a){case "dealer":return this.getDealer();case "vulnerability":return this.getVulnerability();case "level":return this.getSelectedLevel();case "contract":return this.getContract();case "auction":return this.getAuction();default:Bridge._reportError("Unknown deal property "+a,"In Auction.get")}};
Bridge.Auction.prototype.set=function(a,b){Bridge._checkRequiredArgument(a,"Property","In Auction.set");Bridge._checkRequiredArgument(b,"Value for Property "+a,"In Auction.set");switch(a){case "dealer":this.setDealer(b);break;case "vulnerability":this.setVulnerability(b);break;case "level":this.setSelectedLevel(b);case "contract":this.setContract(b);break;case "auction":this.setAuction(b);break;default:Bridge._reportError("Unknown deal property "+a,"In Auction.set")}};
Bridge.Auction.prototype.addCall=function(a,b,d){Bridge._checkBid(a,"In Auction.addCall");a=new Bridge.Call(a,this.nextToCall);d&&a.setAnnotation(d);b&&a.setExplanation(b);b=0===this.calls.length?new Bridge.Contract:this.getContract().clone();b.update(a);this.calls.push(a);this.contracts.push(b);this.nextToCall=Bridge.getLHO(this.nextToCall);this.selectedLevel=0;this.onChange("addCall",a);this.getContract().isComplete&&$(document).trigger("auction:complete",this)};
Bridge.Auction.prototype.addAllPass=function(){for(;!this.getContract().isComplete;)this.addCall("p")};Bridge.Auction.prototype.clearCalls=function(){for(;0<this.calls.length;)this.removeCall()};Bridge.Auction.prototype.removeCall=function(){if(0<this.calls.length){var a=this.calls[this.calls.length-1];this.calls.pop();this.contracts.pop();this.nextToCall=Bridge.getRHO(this.nextToCall);this.selectedLevel=0;this.onChange("removeCall",a.getCall())}};
Bridge.Auction.prototype.fromString=function(a){this.clearCalls();for(var b=0;b<a.length;){for(var d=a[b++].toLowerCase(),d=_.has(Bridge.calls,d)&&!Bridge.isBid(d)?d:d+a[b++].toLowerCase(),c=null,e=null;b<a.length&&("("===a[b]||"{"===a[b]);){if("("===a[b])var f=")",b=Bridge._parseContainedText(a,b,f,"In Auction.fromString"),e=b.text;else f="}",b=Bridge._parseContainedText(a,b,f,"In Auction.fromString"),c=b.text;b=b.position+1}this.addCall(d,c,e)}};Bridge.Auction.prototype.fromJSON=function(a){return this.fromString(a)};
Bridge.Auction.prototype.toString=function(){for(var a="",b=0;b<this.calls.length;++b)a+=this.calls[b].toString();return a};Bridge.Auction.prototype.toJSON=function(){return this.toString()};
Bridge.Auction.prototype.onChange=function(a,b){if(this.triggerEvents&&!this.deal||this.deal.triggerEvents)Bridge.options.enableDebug&&(console.log("auction:changed "+a+" - "+b),console.log("bidding-box:changed "+a+" - "+b)),$(document).trigger("auction:changed",[this,a,b]),$(document).trigger("bidding-box:changed",[this,a,b]);this.deal&&this.deal.triggerEvents&&(console.log("deal:changed "+a+" - "+b),$(document).trigger("deal:changed",[this.deal,a,b]))};Bridge||(Bridge={});Bridge.Contract=function(){this.suit=this.level=null;this.redoubled=this.doubled=!1;this.declarer=null;this.firstToBid={};for(var a in Bridge.calls)if(Bridge.isBid(a)){this.firstToBid[a]={};for(var b in Bridge.directions)this.firstToBid[a][b]=null}this.numPasses=0;this.isComplete=!1};
Bridge.Contract.prototype.allowedCalls=function(a){Bridge._checkDirection(a);var b={};b.p=!this.isComplete;b.ap=b.p;b.x=!1;b.r=!1;for(var d=1;7>=d;++d)for(var c in Bridge.calls)Bridge.isBid(c)&&(b[d+c]=!this.isComplete);b.u=!(null===this.suit&&0===this.numPasses);b.minimum_level=8;if(null===this.suit||this.isComplete)return this.isComplete||(b.minimum_level=1),b;for(d=1;7>=d;++d)for(c in Bridge.calls)Bridge.isBid(c)&&(d>this.level||d===this.level&&Bridge.calls[c].index<Bridge.calls[this.suit].index?
(b[d+c]=!0,d<b.minimum_level&&(b.minimum_level=d)):b[d+c]=!1);b.p=!0;b.x=!this.doubled&&!this.redoubled&&Bridge.areOpponents(a,this.declarer);b.r=this.doubled&&!this.redoubled&&!Bridge.areOpponents(a,this.declarer);return b};Bridge.Contract.prototype.clone=function(){var a=new Bridge.Contract;_.each("level suit doubled redoubled declarer numPasses isComplete".split(" "),function(b){a[b]=this[b]},this);a.firstToBid=_.cloneDeep(this.firstToBid);return a};
Bridge.Contract.prototype.update=function(a){this.isComplete&&Bridge._reportError("Auction is already complete. Cannot make another call");var b=a.getLevel(),d=a.getSuit(),c=a.getDirection();switch(d){case "p":this.numPasses++;if(this.declarer&&3===this.numPasses||4===this.numPasses)this.isComplete=!0;break;case "x":this.declarer&&Bridge.areOpponents(this.declarer,c)&&!this.redoubled&&!this.doubled||Bridge._reportError("Double is not allowed at this point in the auction");this.doubled=!0;this.numPasses=
0;break;case "r":(!this.doubled||Bridge.areOpponents(this.declarer,c)||this.redoubled)&&Bridge._reportError("ReDouble is not allowed at this point in the auction");this.redoubled=!0;this.numPasses=0;break;default:(b<this.level||b===this.level&&Bridge.calls[d].index>=Bridge.calls[this.suit].index)&&Bridge._reportError(a.toString()+" is not allowed at this point in the auction"),this.redoubled=this.doubled=!1,this.numPasses=0,this.firstToBid[d][c]||(this.firstToBid[d][c]=c,this.firstToBid[d][Bridge.getPartner(c)]=
c),this.declarer=this.firstToBid[d][c],this.suit=d,this.level=b}};Bridge.Contract.prototype.toString=function(){var a="";this.level&&(a+=this.level,a+=this.suit,this.redoubled?a+="xx":this.doubled&&(a+="x"),a+=this.declarer);return a};Bridge.Deal.prototype.toHTML=function(){var a;a="<h3>Deal Information</h3>"+("Board : "+this.getBoard()+"<br/>");a+="Dealer : "+Bridge.directions[this.getDealer()].html+"<br/>";a+="Vulnerability : "+Bridge.vulnerabilities[this.getVulnerability()].html+"<br/>";a+="Notes : "+this.getNotes()+"<br/>";a+="<h3>Hands</h3>";for(var b in Bridge.directions)a+=this.getHand(b).toHTML()+"<br/>";a+="<h3>Auction</h3>";return a+=this.getAuction().toHTML()};
Bridge.embedHTML=function(a,b){0===$("#"+a).length?Bridge._reportError("Container with id : "+a+" does not exist!"):$("#"+a).empty().append(b)};Bridge._getID=function(a,b){return a?"id='"+a+"-"+b+"'":""};Bridge._getClasses=function(a,b){var d=[],d=_.union(d,a);_.each(a,function(a){b[a]&&(d=_.union(d,b[a]))},this);var c=d.join(" ");return c?"class='"+c+"'":""};Bridge._getData=function(a,b,d){var c=[],c=_.union(c,b);_.each(a,function(a){d[a]&&(c=_.union(c,d[a]))},this);return c.join(" ")};
Bridge._getTag=function(a,b){for(var d=0;d<b.length;++d)if(_.has(a.tags,b[d]))return a.tags[b[d]];return"div"};Bridge._openTag=function(a,b,d,c,e){if(!a)return"";e=Bridge.assignDefault(e,!0);a="<"+a;e&&(a+=" "+Bridge._getID(b.idPrefix,d[0]));a+=" "+Bridge._getClasses(d,b.classes);a+=" "+Bridge._getData(d,c,b.data);return a+">"};Bridge._closeTag=function(a){return a?"</"+a+">":""};
Bridge._generateHTMLModule=function(a,b,d,c){var e="",f=[a.prefix],n=Bridge._getTag(a,f),e=e+Bridge._openTag(n,a,f,[]);if(b)var f=[a.prefix+"-header"],m=Bridge._getTag(a,f),e=e+Bridge._openTag(m,a,f,[]),e=e+b+Bridge._closeTag(m);d&&(b=[a.prefix+"-content"],f=Bridge._getTag(a,b),e+=Bridge._openTag(f,a,b,[]),e+=d,e+=Bridge._closeTag(f));c&&(d=[a.prefix+"-footer"],b=Bridge._getTag(a,d),e+=Bridge._openTag(b,a,d,[]),e+=c,e+=Bridge._closeTag(b));return e+=Bridge._closeTag(n)};
Bridge._generateClasses=function(a,b){var d=[];_.each(b,function(b){a+="-"+b;d.push(a)},this);return d.reverse()};
Bridge.Hand.prototype.toBBODiagram=function(a){a=Bridge.assignDefault(a,{});a=Bridge.assignDefault(a,{});_.defaults(a,{prefix:"hand-diagram",show:{},tags:{},data:{},classes:{},idPrefix:null,containerID:null,registerChangeHandler:!0});a.show.direction=!0;a.show.name=!0;a.show.count=!1;a.show.suit=!0;a.show.cards=!0;var b=a.prefix;_.has(a.classes,b)?a.classes[b].push("bbo"):a.classes[b]=["bbo"];b=a.prefix;a.tags[b]="table";a.tags[b+"-header"]="thead";a.tags[b+"-content"]="tbody";a.tags[b+"-footer"]=
"tfoot";a.tags[b+"-row"]="tr";a.tags[b+"-column"]="td";a.tags[b+"-field"]="span";return this.toHTML(a)};
Bridge.Hand.prototype.toHTML=function(a,b){b=Bridge.assignDefault(b,!1);a=Bridge.assignDefault(a,{});_.defaults(a,{prefix:"hand-diagram",show:{},tags:{},data:{},classes:{},idPrefix:null,containerID:null,registerChangeHandler:!0});var d=a.prefix;_.defaults(a.show,{direction:!1,name:!1,countInHeader:!1,countInContent:!1,suit:!0,cards:!0});var c={};c[d]="div";c[d+"-header"]="div";c[d+"-content"]="div";c[d+"-footer"]="div";c[d+"-row"]="span";c[d+"-column"]="span";c[d+"-field"]="span";_.defaults(a.tags,
c);a.registerChangeHandler&&!a.idPrefix&&Bridge._reportError("idPrefix is required if change handler has to registered");var c="",e=Bridge._generateClasses(d,["row","info"]),f=Bridge._getTag(a,e),c=c+Bridge._openTag(f,a,e,[]),n=[],m="",h="direction";if(a.show[h])var n=Bridge._generateClasses(d,["column",h]),m=Bridge._getTag(a,n),c=c+Bridge._openTag(m,a,n,[]),k=Bridge._generateClasses(d,["field",h]),g=Bridge._getTag(a,k),q=["data-"+h+"='"+this.get(h)+"'"],c=c+Bridge._openTag(g,a,k,q),c=c+this.get(h).toUpperCase(),
c=c+Bridge._closeTag(g),c=c+Bridge._closeTag(m);h="name";if(a.show[h]){n=Bridge._generateClasses(d,["column",h]);m=Bridge._getTag(a,n);c+=Bridge._openTag(m,a,n,[]);k=Bridge._generateClasses(d,["field",h]);g=Bridge._getTag(a,k);q=["data-"+h+"='"+this.get(h)+"'"];c+=Bridge._openTag(g,a,k,q);c+=this.get(h);if(a.show.countInHeader)var p="count",k=Bridge._generateClasses(d,["field",p]),g=Bridge._getTag(a,k),q=["data-"+p+"='"+this.get(p)+"'"],c=c+Bridge._openTag(g,a,k,q),c=c+("("+this.get(p)+")"),c=c+Bridge._closeTag(g);
c+=Bridge._closeTag(g);c+=Bridge._closeTag(m)}var c=c+Bridge._closeTag(f),l="";_.each(Bridge.suitOrder,function(b){e=Bridge._generateClasses(d,["row",b]);f=Bridge._getTag(a,e);l+=Bridge._openTag(f,a,e,[]);h="suit";if(a.show[h]){n=Bridge._generateClasses(d,["column",h,b]);m=Bridge._getTag(a,n);l+=Bridge._openTag(m,a,n,[]);var c=Bridge._generateClasses(d,["field",h,b]),g=Bridge._getTag(a,c),p=["data-"+h+"='"+b+"'"];l+=Bridge._openTag(g,a,c,p);l+=Bridge.suits[b].html;l+=Bridge._closeTag(g);l+=Bridge._closeTag(m)}h=
"cards";if(a.show[h]){n=Bridge._generateClasses(d,["column",h,b]);m=Bridge._getTag(a,n);l+=Bridge._openTag(m,a,n,[]);var c=Bridge._generateClasses(d,["field",h,b]),g=Bridge._getTag(a,c),p=["data-"+h+"='"+b+"'"],k="",q=0;_.each(Bridge.rankOrder,function(f){this.cards[b][f]&&(q++,c=Bridge._generateClasses(d,["field",h,b,f]),g=Bridge._getTag(a,c),k+=Bridge._openTag(g,a,c,p),k+=Bridge.ranks[f].html,k+=Bridge._closeTag(g))},this);0===q&&(k+="-");l+=k;l+=Bridge._closeTag(m)}l+=Bridge._closeTag(f)},this);
a.show.countInContent&&(p="count",k=Bridge._generateClasses(d,["field",p]),g=Bridge._getTag(a,k),q=["data-"+p+"='"+this.get(p)+"'"],l+=Bridge._openTag(g,a,k,q),l+="("+this.get(p)+")",l+=Bridge._closeTag(g));c=Bridge._generateHTMLModule(a,c,l,"");a.containerID&&Bridge.embedHTML(a.containerID,c);!b&&a.registerChangeHandler&&(k=a.idPrefix+"-"+a.prefix,g="hand:changed."+k,$(document).off(g),$(document).on(g,{config:_.cloneDeep(a),id:k,event:g,direction:this.getDirection()},function(a,b){if(0===$("#"+
a.data.id).length){var d=a.data.event;$(document).off(d)}else b.getDirection()===a.data.direction&&b.toHTML(a.data.config,!0)}));return c};
Bridge.Auction.prototype.toBBODiagram=function(a){a=Bridge.assignDefault(a,{});_.defaults(a,{prefix:"auction-diagram",show:{},tags:{},data:{},classes:{},idPrefix:null,containerID:null,registerChangeHandler:!0,addQuestionMark:!0});var b=a.prefix;a.show.direction=!0;_.has(a.classes,b)?a.classes[b].push("bbo"):a.classes[b]=["bbo"];a.tags[b]="table";a.tags[b+"-header"]="thead";a.tags[b+"-content"]="tbody";a.tags[b+"-footer"]="tfoot";a.tags[b+"-row"]="tr";a.tags[b+"-column"]="td";a.tags[b+"-field"]="span";
return this.toHTML(a)};
Bridge.Auction.prototype.toHTML=function(a,b){b=Bridge.assignDefault(b,!1);a=Bridge.assignDefault(a,{});_.defaults(a,{prefix:"auction-diagram",show:{},tags:{},data:{},classes:{},idPrefix:null,containerID:null,registerChangeHandler:!0,addQuestionMark:!0});var d=a.prefix;_.defaults(a.show,{direction:!1});var c={};c[d]="div";c[d+"-header"]="div";c[d+"-content"]="div";c[d+"-footer"]="div";c[d+"-row"]="span";c[d+"-column"]="span";c[d+"-field"]="span";_.defaults(a.tags,c);a.registerChangeHandler&&!a.idPrefix&&
Bridge._reportError("idPrefix is required if change handler has to registered");var e="",f=Bridge._generateClasses(d,["row","directions"]),c=Bridge._getTag(a,f),e=e+Bridge._openTag(c,a,f,[]),n=[],m="",h="direction",k=this.vulnerability;a.show[h]&&_.each(Bridge.directionOrder,function(b){n=Bridge._generateClasses(d,["column",h,b]);m=Bridge._getTag(a,n);e+=Bridge._openTag(m,a,n,[]);var c=Bridge._generateClasses(d,["field",h,b]);"b"!=k&&k!=b&&k!=Bridge.getPartner(b)||c.push("vulnerable");var g=Bridge._getTag(a,
c);e+=Bridge._openTag(g,a,c,["data-"+h+"='"+b+"'"]);e+=b.toUpperCase();e+=Bridge._closeTag(g);e+=Bridge._closeTag(m)},this);for(var e=e+Bridge._closeTag(c),g="",h="call",q=0,f=Bridge._generateClasses(d,["row","calls",q]),c=Bridge._getTag(a,f),g=g+Bridge._openTag(c,a,f,[]),p="w",f=!0;this.dealer!==p;)var f=!1,p=Bridge.getLHO(p),n=Bridge._generateClasses(d,["column",h,p]),m=Bridge._getTag(a,n),g=g+Bridge._openTag(m,a,n,[]),l=Bridge._generateClasses(d,["field",h,p]),r=Bridge._getTag(a,l),s=["data-"+
h+"='' data-direction='"+p+"'"],g=g+Bridge._openTag(r,a,l,s),g=g+Bridge._closeTag(r),g=g+Bridge._closeTag(m);for(var t=0;t<this.calls.length;++t){var u=this.calls[t],p=u.getDirection();"w"!==p||f||(g+=Bridge._closeTag(c),q++,f=Bridge._generateClasses(d,["row","calls",q]),c=Bridge._getTag(a,f),g+=Bridge._openTag(c,a,f,[]));n=Bridge._generateClasses(d,["column",h,p]);m=Bridge._getTag(a,n);g+=Bridge._openTag(m,a,n,[]);l=Bridge._generateClasses(d,["field",h,p]);r=Bridge._getTag(a,l);s=["data-"+h+"='"+
u.toString()+"' data-direction='"+p+"'"];g+=Bridge._openTag(r,a,l,s);g+=u.toHTML();g+=Bridge._closeTag(r);g+=Bridge._closeTag(m);f=!1}0<this.calls.length&&(p=Bridge.getLHO(p));!this.getContract().isComplete&&a.addQuestionMark&&("w"===p&&(q++,f=Bridge._generateClasses(d,["row","calls",q]),c=Bridge._getTag(a,f),g+=Bridge._closeTag(c),g+=Bridge._openTag(c,a,f,[])),n=Bridge._generateClasses(d,["column",h,p]),m=Bridge._getTag(a,n),g+=Bridge._openTag(m,a,n,[]),l=Bridge._generateClasses(d,["field",h,p]),
r=Bridge._getTag(a,l),s=["data-"+h+"='?' data-direction='"+p+"'"],g+=Bridge._openTag(r,a,l,s),g=g+"?"+Bridge._closeTag(r),g+=Bridge._closeTag(m),p=Bridge.getLHO(p));for(;"w"!==p;)n=Bridge._generateClasses(d,["column",h,p]),m=Bridge._getTag(a,n),g+=Bridge._openTag(m,a,n,[]),l=Bridge._generateClasses(d,["field",h,p]),r=Bridge._getTag(a,l),s=["data-"+h+"='' data-direction='"+p+"'"],g+=Bridge._openTag(r,a,l,s),g+=Bridge._closeTag(r),g+=Bridge._closeTag(m),p=Bridge.getLHO(p);g+=Bridge._closeTag(c);c=Bridge._generateHTMLModule(a,
e,g,"");a.containerID&&Bridge.embedHTML(a.containerID,c);!b&&a.registerChangeHandler&&(g=a.idPrefix+"-"+a.prefix,q="auction:changed."+g,$(document).on(q,{config:_.cloneDeep(a),id:g,event:q},function(a,b){if(0===$("#"+a.data.id).length){var c=a.data.event;$(document).off(c)}else b.toHTML(a.data.config,!0)}));return c};Bridge.Call.prototype.toHTML=function(a){a="";return a=1===this.call.length?a+Bridge.calls[this.call].html:a+(this.call[0]+Bridge.calls[this.call[1]].html)};
Bridge.Contract.prototype.toHTML=function(){var a="";this.level&&(a+=this.level,a+=Bridge.calls[this.suit].html,this.redoubled?a+=Bridge.calls.r.html:this.doubled&&(a+=Bridge.calls.x.html),a+=" by "+Bridge.directions[this.declarer].html);return a};
Bridge.Deal.prototype.toCardDeck=function(a,b){b=Bridge.assignDefault(b,!1);a=Bridge.assignDefault(a,{});_.defaults(a,{prefix:"card-deck",show:{},tags:{},data:{},classes:{},idPrefix:null,containerID:null,registerChangeHandler:!0});var d=a.prefix;_.defaults(a.show,{title:!0,activeHand:!0,text:!0,assignedTo:!0,reset:!1});var c={};c[d]="table";c[d+"-header"]="thead";c[d+"-content"]="tbody";c[d+"-footer"]="tfoot";c[d+"-row"]="tr";c[d+"-column"]="td";c[d+"-field"]="span";_.defaults(a.tags,c);var c="",
e=Bridge._generateClasses(d,["row","title"]),f=Bridge._getTag(a,e),c=c+Bridge._openTag(f,a,e,[]),n=[],m="",h="title";if(a.show[h]){var n=Bridge._generateClasses(d,["column",h]),m=Bridge._getTag(a,n),c=c+Bridge._openTag(m,a,n,["colspan=13"]),k=Bridge._generateClasses(d,["field",h]),g=Bridge._getTag(a,k),q=[],c=c+Bridge._openTag(g,a,k,q),q="Assign / Unassign cards";a.show.activeHand&&(q="Assign Cards to Active Hand : "+Bridge.directions[this.getActiveHand()].name+" / Unassign from any hand");c=c+q+
Bridge._closeTag(g);c+=Bridge._closeTag(m)}var c=c+Bridge._closeTag(f),p="",h="cards";_.each(Bridge.suitOrder,function(b){e=Bridge._generateClasses(d,["row",h,b]);f=Bridge._getTag(a,e);var c=["data-suit='"+b+"'"];p+=Bridge._openTag(f,a,e,c);_.each(Bridge.rankOrder,function(f){var e=this._cardAssignedTo[b][f];e||(e="");n=Bridge._generateClasses(d,["column",h,b,f]);e&&n.push("assigned");m=Bridge._getTag(a,n);c=["data-suit='"+b+"'","data-rank='"+f+"'","data-assignedto='"+e+"'"];p+=Bridge._openTag(m,
a,n,c);k=Bridge._generateClasses(d,["field",h,b,f]);e?(k.push("assigned"),k.push("assigned-"+e)):k.push("unassigned");g=Bridge._getTag(a,k);p+=Bridge._openTag(g,a,k,c);a.show.text&&(p+=Bridge.suits[b].html+Bridge.ranks[f].html);a.show.assignedTo&&e&&(p+="("+e.toUpperCase()+")");p+=Bridge._closeTag(g);p+=Bridge._closeTag(m)},this);p+=Bridge._closeTag(f)},this);var l="";a.show.reset&&(e=Bridge._generateClasses(d,["row","reset"]),f=Bridge._getTag(a,e),l+=Bridge._openTag(f,a,e,[]),n=[],m="",h="reset",
n=Bridge._generateClasses(d,["column",h]),m=Bridge._getTag(a,n),l+=Bridge._openTag(m,a,n,["colspan=13"]),k=Bridge._generateClasses(d,["field",h]),g=Bridge._getTag(a,k),q=[],l+=Bridge._openTag(g,a,k,q),l=l+"Reset/Clear Hand"+Bridge._closeTag(g),l+=Bridge._closeTag(m),l+=Bridge._closeTag(f));c=Bridge._generateHTMLModule(a,c,p,l);a.containerID&&Bridge.embedHTML(a.containerID,c);a.registerChangeHandler&&(q=a.idPrefix+"-"+a.prefix,$("#"+q).on("click",".card-deck-field-cards",{deal:this},function(a){try{var b=
$(this).data("suit"),c=$(this).data("rank"),d=$(this).data("assignedto");d?a.data.deal.getHand(d).removeCard(b,c):a.data.deal.getHand(a.data.deal.getActiveHand()).addCard(b,c)}catch(g){alert(g.message)}}),$("#"+q).on("click",".card-deck-field-reset",{deal:this},function(a){try{var b=a.data.deal;b.getHand(b.getActiveHand()).clearCards()}catch(c){alert(c.message)}}),b||(l="hand:changed."+q,$(document).off(l),$(document).on(l,{deal:this,config:_.cloneDeep(a),id:q,event:l},function(a,b){var c=a.data.id;
console.log("card deck : "+a.data.event);0===$("#"+c).length?(c=a.data.event,$(document).off(c)):a.data.deal.toCardDeck(a.data.config,!0)})));return c};
Bridge.Auction.prototype.toBiddingBox=function(a,b){b=Bridge.assignDefault(b,!1);a=Bridge.assignDefault(a,{});_.defaults(a,{layout:"full",prefix:"bidding-box",show:{},tags:{},data:{},classes:{},idPrefix:null,containerID:null,registerChangeHandler:!0});_.defaults(a.show,{allpass:!0,undo:!0,reset:!0});var d=a.prefix,c={};c[d]="table";c[d+"-header"]="thead";c[d+"-content"]="tbody";c[d+"-footer"]="tfoot";c[d+"-row"]="tr";c[d+"-column"]="td";c[d+"-field"]="span";_.defaults(a.tags,c);d="concise"===a.layout?
this._createConciseBiddingBox(a):this._createFullBiddingBox(a);a.containerID&&Bridge.embedHTML(a.containerID,d);if(a.registerChangeHandler&&(c=a.idPrefix+"-"+a.prefix,$("#"+c).on("click",".bidding-box-field-level.enabled",{auction:this},function(a){var b=$(this).data("level");console.log("Level is "+b);a.data.auction.setSelectedLevel(b)}),$("#"+c).on("click",".bidding-box-field-calls.enabled",{auction:this},function(a){try{var b=$(this).data("call"),c=a.data.auction;console.log("Call is "+b);"allpass"===
b?c.addAllPass():"undo"===b?c.removeCall():"reset"===b?c.clearCalls():c.addCall(b)}catch(d){alert(d.message)}}),!b)){var e="bidding-box:changed."+c;$(document).off(e);$(document).on(e,{config:_.cloneDeep(a),id:c,event:e},function(a,b){var c=a.data.id;console.log("bidding-box "+a.data.event);0===$("#"+c).length?(c=a.data.event,$(document).off(c)):b.toBiddingBox(a.data.config,!0)})}return d};
Bridge.Auction.prototype._createConciseBiddingBox=function(a){var b=this.getContract().allowedCalls(this.nextToCall),d=this.getSelectedLevel(),c=a.prefix,e=b.minimum_level,f="",n="level",m=Bridge._generateClasses(c,["row","level"]),h=Bridge._getTag(a,m),f=f+Bridge._openTag(h,a,m,[]);_.each(_.range(0,8),function(b){g=Bridge._generateClasses(c,["column",n,b]);data=["data-level='"+b+"'"];q=Bridge._getTag(a,g);if(0===b)f+="<"+q+"/>";else{f+=Bridge._openTag(q,a,g,data);var l=Bridge._generateClasses(c,
["field",n,b]),h=Bridge._getTag(a,l);b===d&&l.push("selected");b>=e?l.push("enabled"):(l.push("disabled"),data.push("disabled"));f+=Bridge._openTag(h,a,l,data);f+=b;f+=Bridge._closeTag(h)}f+=Bridge._closeTag(q)},this);n="calls";m=Bridge._generateClasses(c,["row",n]);h=Bridge._getTag(a,m);f+=Bridge._openTag(h,a,m,[]);_.each(Bridge.callOrder.slice().reverse(),function(e){var l=Bridge.isBid(e)?Bridge.calls[e].html:Bridge.calls[e].text;g=Bridge._generateClasses(c,["column",n,e]);var h=Bridge.isBid(e)?
d+e:e;data=["data-suit='"+e+"'","data-call='"+h+"'"];q=Bridge._getTag(a,g);f+=Bridge._openTag(q,a,g,data);var k=Bridge._generateClasses(c,["field",n,e]),m=Bridge._getTag(a,k);d&&Bridge.isBid(e);b[h]?k.push("enabled"):(k.push("disabled"),data.push("disabled"));f+=Bridge._openTag(m,a,k,data);f+=l;f+=Bridge._closeTag(m);f+=Bridge._closeTag(q)},this);var f=f+Bridge._closeTag(h),k="",m=Bridge._generateClasses(c,["row","utilities"]),h=Bridge._getTag(a,m),k=k+Bridge._openTag(h,a,m,[]),g=[],q="",n="calls";
_.each([{field:"allpass",text:"All Pass",call:"allpass",bid:"p"},{field:"skip"},{field:"undo",text:"Undo",call:"undo",bid:"u"},{field:"skip"},{field:"reset",text:"Reset",call:"reset",bid:"u"}],function(d){g=Bridge._generateClasses(c,["column",n,d.field]);q=Bridge._getTag(a,g);data=["data-bid='"+d.call+"'","data-call='"+d.call+"'"];data.push("colspan=2");if(a.show[d.field]&&"skip"!==d.field){k+=Bridge._openTag(q,a,g,data);var e=Bridge._generateClasses(c,["field",n,d.field]),f=Bridge._getTag(a,e);b[d.bid]?
e.push("enabled"):(e.push("disabled"),data.push("disabled"));k+=Bridge._openTag(f,a,e,data);k+=d.text;k+=Bridge._closeTag(f)}else k+="<"+q+"/>";k+=Bridge._closeTag(q)},this);k+=Bridge._closeTag(h);return Bridge._generateHTMLModule(a,"",f,k)};
Bridge.Auction.prototype._createFullBiddingBox=function(a){var b=this.getContract().allowedCalls(this.nextToCall),d=a.prefix,c="",e=Bridge._generateClasses(d,["row","special-bids"]),f=Bridge._getTag(a,e),c=c+Bridge._openTag(f,a,e,[]),n=[],m="",e=[{field:"pass",text:"Pass",call:"p",bid:"p"},{field:"skip"},{field:"double",text:"X",call:"x",bid:"x"},{field:"skip"},{field:"redouble",text:"XX",call:"r",bid:"r"}];_.each(e,function(e){n=Bridge._generateClasses(d,["column","calls",e.bid]);m=Bridge._getTag(a,
n);var f=["data-bid='"+e.call+"'","data-call='"+e.call+"'"];if("skip"!==e.field){c+=Bridge._openTag(m,a,n,f);var h=Bridge._generateClasses(d,["field","calls",e.bid]);b[e.bid]?h.push("enabled"):(h.push("disabled"),f.push("disabled"));var l=Bridge._getTag(a,h);c+=Bridge._openTag(l,a,h,f);c+=e.text;c+=Bridge._closeTag(l)}else c+="<"+m+"/>";c+=Bridge._closeTag(m)},this);var c=c+Bridge._closeTag(f),h="";_.each(_.range(1,8),function(c){var e=Bridge._generateClasses(d,["row","level",c]),f=Bridge._getTag(a,
e);h+=Bridge._openTag(f,a,e,[]);_.each(Bridge.callOrder.slice().reverse(),function(e){if(Bridge.isBid(e)){var f=c+e,k=c+Bridge.calls[e].html;n=Bridge._generateClasses(d,["column","calls",c,e]);var p=["data-level='"+c+"'","data-bid='"+e+"'","data-call='"+f+"'"];m=Bridge._getTag(a,n);h+=Bridge._openTag(m,a,n,p);e=Bridge._generateClasses(d,["field","calls",c,e]);var q=Bridge._getTag(a,e);b[f]?e.push("enabled"):(e.push("disabled"),p.push("disabled"));h+=Bridge._openTag(q,a,e,p);h+=k;h+=Bridge._closeTag(q);
h+=Bridge._closeTag(m)}},this);h+=Bridge._closeTag(f)},this);var k="",e=Bridge._generateClasses(d,["row","utilities"]),f=Bridge._getTag(a,e),k=k+Bridge._openTag(f,a,e,[]),n=[],m="",e=[{field:"allpass",text:"All Pass",call:"allpass",bid:"p"},{field:"skip"},{field:"undo",text:"Undo",call:"undo",bid:"u"},{field:"skip"},{field:"reset",text:"Reset",call:"reset",bid:"u"}];_.each(e,function(c){n=Bridge._generateClasses(d,["column","calls",c.field]);m=Bridge._getTag(a,n);var e=["data-bid='"+c.call+"'","data-call='"+
c.call+"'"];if(a.show[c.field]&&"skip"!==c.field){k+=Bridge._openTag(m,a,n,e);var f=Bridge._generateClasses(d,["field","calls",c.field]),h=Bridge._getTag(a,f);b[c.bid]?f.push("enabled"):(f.push("disabled"),e.push("disabled"));k+=Bridge._openTag(h,a,f,e);k+=c.text;k+=Bridge._closeTag(h)}else k+="<"+m+"/>";k+=Bridge._closeTag(m)},this);k+=Bridge._closeTag(f);return Bridge._generateHTMLModule(a,c,h,k)};
